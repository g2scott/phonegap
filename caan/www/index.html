<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="1">
    <meta name="keywords" content="2">
    <meta name="author" content="3">
    <link rel="shortcut icon" href="./img/favicon.png"> 
    

    <title>CAAN</title>

    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.css" rel="stylesheet">
    
    <!-- Add custom CSS here -->
    <link href="./css/shop-homepage.css" rel="stylesheet">
    <link href="./css/responsive_video.css" rel="stylesheet">
    <link href="./css/custom.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
	
</head>

<body>

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="./index.html">
                 <img style="max-width:100px; margin-top: -5px;"
             src="./img/home.png"></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    <li id="stream"><a href="stream"><span class="glyphicon glyphicon-film">Stream</a>
                    </li>
                    <li>
                        
             <div class="input-group input-group-sm">
         <form class="navbar-form" role="search">
         <div class="input-group">
             <input type="text" class="form-control" placeholder="Search" name="srch-term" id="srch-term">
             <div class="input-group-btn">
                 <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
             </div>
         </div>
         </form>
         </div>
                    </li>
                    <li id="signin"><a href="login.html"></a>
                    </li>
                    <li id="signup"><a href="register.html"></a>
                    </li>  
                    
					<a style="color:#428bca;">beta</a>
                    
                </ul>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
    
    
    <div class="container">



      <form id="login_form" class="form-signin" role="form" action="http://caanapp.ca/caan/main/index.php/account/login" method="post">
      
      <h2 class="form-signin-heading">Login</h2>
      <h4 id="error" class="form-signin-heading"></h4>
        
        
        <input type="text" class="form-control" placeholder="Email" name="email" required autofocus>
        <input type="password" class="form-control" placeholder="Password" name="password" required>
        <label class="checkbox">
          <input type="checkbox" value="remember-me"> Remember me
        </label>
        <button class="btn btn-lg btn-default btn-block" type="submit">Login</button>

<button type='button' class="btn btn-lg" onclick="login()"><img style="width: 90%; height: 90%; margin-top: -5px; vertical-align: middle;"
             src="./img/facebook-connect-button.png"></button>


	

    </div> <!-- /container -->
    <script>
  
</script>

<!--
  Below we include the Login Button social plugin. This button uses
  the JavaScript SDK to present a graphical Login button that triggers
  the FB.login() function when clicked.
-->

<!-- <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
</fb:login-button> -->

<div id="status">
</div>

    <script src="./js/jquery-1.10.2.js"></script>
    <script src="./js/bootstrap.js"></script>
    <script src="cordova.js"></script>
        <script src="./openfb.js"></script>
    
    <script type="text/javascript">
    var frm = $('#login_form');
    frm.submit(function (ev) {
        $.ajax({
           	async: false,
        	dataType: 'json',
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                if (data.status == 'success'){
					//alert(data.message);
            		window.location.href = '<?=site_url();?>' + data.message;
                }if (data.status == 'error'){
					//alert("Incorrect username or password!");
					
            		//window.location.href = '<?=site_url();?>' + data.message;
            		document.getElementById("error").innerHTML = data.message;
                }
            },
        });

        ev.preventDefault();
    });
	</script>
	
<script>

     // Defaults to sessionStorage for storing the Facebook token
     openFB.init({appId: '129704493787021'});

    //  Uncomment the line below to store the Facebook token in localStorage instead of sessionStorage
    //  openFB.init({appId: 'YOUR_FB_APP_ID', tokenStore: window.localStorage});

    function login() {
        openFB.login(
                function(response) {
                    if(response.status === 'connected') {
						alert('Facebook login succeeded, got access token: ' + response.authResponse.token);
                        this.getInfo();
                    } else {
                        alert('Facebook login failed: ' + response.error);
                    }
                }, {scope: 'email,read_stream,publish_stream'});
    }

    function getInfo() {
        openFB.api({
            path: '/me',
            success: function(response) {
                console.log(JSON.stringify(response));
                //document.getElementById("userName").innerHTML = data.name;
                //document.getElementById("userPic").src = 'http://graph.facebook.com/' + data.id + '/picture?type=small';
             // document.getElementById('status').innerHTML =
             // 'Thanks for logging in, ' + response.name + '!';
                   
                   var f = document.createElement("form");
                   f.setAttribute('method',"post");
                   f.setAttribute('action',"login_user");
                   f.setAttribute('id',"fb_form");

                   var name = document.createElement("input"); //input element, text
                   name.setAttribute('type',"hidden");
                   name.setAttribute('name',"user_name");
                   name.setAttribute('value',response.name);
                   
                   var email = document.createElement("input"); //input element, text
                   email.setAttribute('type',"hidden");
                   email.setAttribute('name',"email");
                   email.setAttribute('value',response.email);
                   
                   var id = document.createElement("input"); //input element, text
                   id.setAttribute('type',"hidden");
                   id.setAttribute('name',"id");
                   id.setAttribute('value',response.id);

                   var pic = document.createElement("input"); //input element, text
                   pic.setAttribute('type',"hidden");
                   pic.setAttribute('name',"userPic");
                   pic.setAttribute('value','http://graph.facebook.com/' + response.id + '/picture?type=normal');

                   f.appendChild(name);
                   f.appendChild(email);
                   f.appendChild(id);
                   f.appendChild(pic);


                   document.getElementsByTagName('body')[0].appendChild(f);
                   
                   var frm = $('#fb_form');
                   
                     $.ajax({
                         async: false,
                      dataType: 'json',
                         type: frm.attr('method'),
                         url: "login_user",
                         data: frm.serialize(),
                         success: function (data) {
                             if (data.status == "success"){
                             	alert(data.message);
                             	window.location.href = "main.html";
                             }
                             if (data.status == "error"){
                                 //alert(data.message);
                            	 document.getElementById("error").innerHTML = data.message;
                             }
                         }
                     });
                     
            },
            error: errorHandler});
    }

    function share() {
        openFB.api({
            method: 'POST',
            path: '/me/feed',
            params: {
                message: document.getElementById('Message').value || 'Testing Facebook APIs',
            },
            success: function() {
                alert('the item was posted on Facebook');
            },
            error: errorHandler});
    }

    function revoke() {
        openFB.revokePermissions(
                function() {
                    alert('Permissions revoked');
                },
                errorHandler);
    }

    function logout() {
        openFB.logout(
                function() {
                    alert('Logout successful');
                },
                errorHandler);
    }

    function errorHandler(error) {
        alert(error.message);
    }
    
	//
</script>

	<script>
function loadMenubar (url) {
	$.getJSON( url + '/main_page/check_login', function(data){
		// console.log(data);
		if (data.login != false) {
			var profile = "<a href=\"";
			profile += url + '/profile_page';
			profile += "\"><span class=\"glyphicon glyphicon-user\">Profile</a>";
			var logout = "<a href=\"";
			logout += url + '/account/logout_user';
			logout += "\" onclick=\"logout()\"><span class=\"glyphicon glyphicon-user\">Log-out</a>";
			$('#signin').html(profile);
			$('#signup').html(logout);
		} else {
			var signin = "<a href=\"";
			signin += url + '/account/load_login';
			signin += "\"><span class=\"glyphicon glyphicon-user\">Login</a>";
			var signup = "<a href=\"";
			signup += url + '/account/register_user';
			signup += "\"><span class=\"glyphicon glyphicon-user\">Register</a>";
			$('#signin').html(signin);
			$('#signup').html(signup);

		}
	}) // getJSON end
}
loadMenubar('http://caanapp.ca/caan/main/');
</script>
	

<div id="status">
</div>
    
    <div class="container">
        <hr>
        <footer>
        </footer>
    </div>
    
  </body>
</html>